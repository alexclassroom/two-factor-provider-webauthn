!function(e){function t(){return t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}var n=e.__("WebAuthn is not supported by the browser.","2fa-wa-js"),r=e.__("Unable to get a public key credential.","2fa-wa-js"),a=e.__("The request is not allowed.","2fa-wa-js"),i=e.__("The operation is insecure.","2fa-wa-js"),o=e.__("The operation is not supported.","2fa-wa-js"),s=e.__("The operation was canceled.","2fa-wa-js"),d=e.__("You cannot use this key to log in.","2fa-wa-js"),u=e.__("This key is already registered.","2fa-wa-js");function c(e){return window.btoa(String.fromCharCode.apply(String,e))}function l(e){return window.atob(e.replace(/-/g,"+").replace(/_/g,"/")+"=".repeat(3-(3+e.length)%4))}function f(e){return e.charCodeAt(0)}function w(e){var t=document.getElementById("login_error");t&&t.parentNode&&t.parentNode.removeChild(t);var n=document.getElementById("loginform");n&&n.insertAdjacentHTML("beforebegin",'<div id="login_error" role="alert"><p>'+e+"</p></div>")}function g(){var e=document.getElementById("loginform"),n=function(e){var n;return t({},e,{challenge:Uint8Array.from(l(e.challenge),f).buffer,allowCredentials:null===(n=e.allowCredentials)||void 0===n?void 0:n.map((function(e){return t({},e,{id:Uint8Array.from(l(e.id),f).buffer})}))})}(tfa_webauthn.options);navigator.credentials.get({publicKey:n}).then((function(t){if(!t)throw new Error(r);var n,a;document.getElementById("webauthn_response").value=JSON.stringify((a=(n=t).response,{id:n.id,type:n.type,rawId:c(new Uint8Array(n.rawId)),clientExtensionResults:n.getClientExtensionResults(),response:{attestationObject:"attestationObject"in a?c(new Uint8Array(a.attestationObject)):void 0,authenticatorData:"authenticatorData"in a?c(new Uint8Array(a.authenticatorData)):void 0,signature:"signature"in a?c(new Uint8Array(a.signature)):void 0,userHandle:"userHandle"in a&&a.userHandle?c(new Uint8Array(a.userHandle)):void 0,clientDataJSON:c(new Uint8Array(n.response.clientDataJSON))}})),e.submit()})).catch((function(e){w(e instanceof DOMException?function(e,t){switch(e.name){case"NotAllowedError":return a;case"SecurityError":return i;case"NotSupportedError":return o;case"AbortError":return s;case"InvalidStateError":return t?d:u;default:return e.message}}(e,!0):e.message),document.getElementById("webauthn-retry").removeAttribute("hidden")}))}e.__("This key is already registered.","2fa-wa-js"),e.__("Fetching registration information…","2fa-wa-js"),e.__("Generating credentials…","2fa-wa-js"),e.__("Registering credentials…","2fa-wa-js"),e.__("Unable to create public key credentials","2fa-wa-js"),e.__("The key has been registered.","2fa-wa-js"),e.__("Sending request…","2fa-wa-js"),e.__("The key has been revoked.","2fa-wa-js"),e.__("The key has been renamed.","2fa-wa-js");var h=function(){document.querySelector("#webauthn-retry .button").addEventListener("click",(function(e){document.getElementById("webauthn-retry").setAttribute("hidden","hidden"),g()})),"credentials"in navigator?g():w(n)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}(wp.i18n);
